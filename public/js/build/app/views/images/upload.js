define(["marionette","text!app/templates/images/upload.html","app/collections/images","app/models/image"],function(e,t,n,r){"use strict";return Backbone.Marionette.ItemView.extend({template:t,tagName:"div",className:"item",events:{"click .save":"onClickSaveImages","click .clear":"onClickClearImages"},initialize:function(e){this.options=e,this.collection=new n},onClickSaveImages:function(){var e=this.collection.length,t=0,n=this;_.each(this.collection.toJSON(),function(i,s){var o=new r(i);o.save({},{complete:function(){t++,n.onSavedImage(t,e)}})})},onSavedImage:function(e,t){e==t&&(MyApp.vent.trigger("filter:change"),MyApp.vent.trigger("quickview:close"))},onClickClearImages:function(){this.collection.reset(),this.render()},onRender:function(){var e=this;setTimeout(function(){$("#choose").change(function(t){if(this.disabled)return alert("File upload not supported!");var n=this.files;if(n&&n[0])for(var r=0;r<n.length;r++)e.readImage(n[r])})})},readImage:function(e){var t=new FileReader,r=new Image,i=new n,s=this;t.readAsDataURL(e),t.onload=function(t){r.src=t.target.result,r.onload=function(){var t={height:this.height,width:this.width,filename:e.name,type:e.type,size:~~(e.size/1024),base64:this.src};s.collection.add(t),s.render()},r.onerror=function(){alert("Invalid file type: "+e.type)}}},serializeData:function(){return{collection:this.collection.toJSON(),quickview:_.has(this.options,"quickview")?this.options.quickview:!1}}})});