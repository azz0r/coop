define(["marionette","text!app/templates/profiles/form.html","app/models/profile","json!app/store/country.json","json!app/store/city.json","json!app/store/occupation.json","app/views/partials/success"],function(e,t,n,r,i,s,o){"use strict";return Backbone.Marionette.ItemView.extend({template:t,tagName:"div",events:{"click .update":"onClickUpdate"},initialize:function(){this.currentUserId=_.getUser()._id.$id,this.model=new n,this.model.set("id",this.currentUserId);var e=this;this.model.fetch({success:function(t){return e.setModel(t.attributes)},error:function(t){return e.render()}})},setModel:function(e){this.model.set(e),this.render()},onClickUpdate:function(e){e.preventDefault();var t={name:this.$el.find(".name").val(),is_a:this.$el.find(".is_a").val(),is_for:this.$el.find(".is_for").val(),height:this.$el.find(".height").val(),city_id:this.$el.find(".city_id").val(),country_id:this.$el.find(".country_id").val(),sex:this.$el.find(".sex").val(),age:this.$el.find(".age").val(),occupation:this.$el.find(".occupation").val(),education:this.$el.find(".education").val(),religion:this.$el.find(".religion").val(),star_sign:this.$el.find(".star_sign").val(),income:this.$el.find(".income").val(),hair_colour:this.$el.find(".hair_colour").val(),eye_colour:this.$el.find(".eye_colour").val(),body:this.$el.find(".body").val(),ethnicity:this.$el.find(".ethnicity").val(),screening:this.$el.find(".screening").val(),smoke:this.$el.find(".smoke").val(),drink:this.$el.find(".drink").val(),blurb:this.$el.find(".blurb").val()},r=this;$(".alert").addClass("hide"),this.model=new n(t),this.model.save({},{success:function(e){$.quickview({className:"success",view:new o({message:"Your profile has successfully been saved"})})},error:function(e,t){var n=JSON&&JSON.parse(t.responseText)||$.parseJSON(t.responseText);_.each(n.data.errors,function(e,t){$("."+t+"-error").removeClass("hide").html(e)})}})},render:function(){var e={model:this.model.toJSON(),lists:{country:r,city:i,occupation:s},options:{isA:this.model.getIsAOptions(),isFor:this.model.getIsForOptions(),height:this.model.getHeightOptions(),age:this.model.getAgeOptions(),sex:this.model.getSexOptions(),education:this.model.getEducationOptions(),religion:this.model.getReligionOptions(),starSign:this.model.getStarSignOptions(),income:this.model.getIncomeOptions(),hairColour:this.model.getHairColourOptions(),body:this.model.getBodyOptions(),ethnicity:this.model.getEthnicityOptions(),eyeColour:this.model.getEyeColourOptions(),screening:this.model.getScreeningOptions(),smoke:this.model.getSmokeOptions(),drink:this.model.getDrinkOptions()}},n=_.template($(t).html(),e);return this.$el.html(n),this}})});