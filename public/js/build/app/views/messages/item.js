define(["marionette","text!app/templates/messages/item.html","app/models/message"],function(e,t,n){"use strict";return Backbone.Marionette.ItemView.extend({template:t,tagName:"div",className:"row",events:{"click .sendMessage":"onClickSendMessage"},onClickSendMessage:function(e){e.preventDefault();var t=new n({message:this.$el.find(".newMessage").val(),to_user:this.otherUserId,in_reply_to:this.lastMessage.in_reply_to.$id}),r=this;t.save({},{success:function(){MyApp.vent.trigger("filter:change")},error:function(){alert("There was an error saving your reply, please try again")}})},serializeData:function(){return this.modelObject=this.model.toJSON(),this.arrayObject=$.map(this.modelObject,function(e,t){return e}),this.lastMessage=this.arrayObject[this.arrayObject.length-1],this.otherUserId=this.lastMessage.to_user._id.$id=_.getUser()._id.$id?this.lastMessage.by_user._id.$id:this.lastMessage.to_user._id.$id,{messages:this.arrayObject.reverse(),lastMessage:this.lastMessage,messageCount:this.arrayObject.length}}})});